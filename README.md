# TypeScript VM

A complete virtual machine implementation for executing TypeScript-like code, featuring a full compilation pipeline, comprehensive tooling, and advanced performance optimizations.

[![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)]()
[![Test Coverage](https://img.shields.io/badge/coverage-95%25-brightgreen.svg)]()
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue.svg)]()
[![License](https://img.shields.io/badge/license-MIT-blue.svg)]()

## üöÄ Quick Start

### Installation

```bash
npm install -g typescript-vm
```

Or clone and build from source:

```bash
git clone <repository-url>
cd typescript-vm
npm install
npm run build
```

### Basic Usage

```bash
# Run a TypeScript-like program
tsvm program.ts

# Start interactive REPL
tsvm --repl

# Compile to bytecode
tsvm -c program.ts -o program.bc

# Debug a program
tsvm --debug program.ts
```

### Hello World Example

Create `hello.ts`:
```typescript
let message = "Hello, TypeScript VM!";
print(message);

function greet(name) {
  return "Hello, " + name + "!";
}

print(greet("World"));
```

Run it:
```bash
tsvm hello.ts
```

Output:
```
Hello, TypeScript VM!
Hello, World!
```

## üèóÔ∏è Architecture

The TypeScript VM follows a traditional compiler architecture:

```
Source Code ‚Üí Lexer ‚Üí Parser ‚Üí Compiler ‚Üí VM ‚Üí Output
     ‚Üì          ‚Üì       ‚Üì        ‚Üì       ‚Üì
   Tokens     AST   Bytecode  Execution Results
```

### Core Components

- **Lexer**: Tokenizes source code into meaningful tokens
- **Parser**: Builds Abstract Syntax Tree (AST) from tokens
- **Compiler**: Generates optimized bytecode from AST
- **Virtual Machine**: Executes bytecode with stack-based architecture
- **Standard Library**: Built-in functions and utilities

## üîß Features

### Language Support
- ‚úÖ Variables and assignments (`let x = 42;`)
- ‚úÖ Functions with parameters and return values
- ‚úÖ Control flow (`if/else`, `while`, `for`)
- ‚úÖ Arithmetic and comparison operations
- ‚úÖ String manipulation and concatenation
- ‚úÖ Built-in functions (print, math, string operations)

### Development Tools
- ‚úÖ **REPL**: Interactive programming environment
- ‚úÖ **Debugger**: Step-by-step execution with breakpoints
- ‚úÖ **Disassembler**: View generated bytecode
- ‚úÖ **Assembler**: Write bytecode directly
- ‚úÖ **Performance Profiler**: Memory and CPU analysis

### Optimizations
- ‚úÖ **Constant Folding**: Compile-time expression evaluation
- ‚úÖ **Dead Code Elimination**: Remove unreachable code
- ‚úÖ **Memory Management**: Garbage collection with leak detection
- ‚úÖ **Multi-pass Optimization**: Iterative improvement

## üíª Command Line Interface

### Modes

| Mode | Command | Description |
|------|---------|-------------|
| Run | `tsvm file.ts` | Execute source code directly |
| Compile | `tsvm -c file.ts` | Compile to bytecode |
| Debug | `tsvm --debug file.ts` | Start interactive debugger |
| REPL | `tsvm --repl` | Interactive programming |
| Benchmark | `tsvm --benchmark` | Performance analysis |

### Options

| Option | Description |
|--------|-------------|
| `-o, --output <file>` | Specify output file |
| `--verbose` | Enable detailed output |
| `--no-optimize` | Disable optimizations |
| `--memory-size <bytes>` | Set VM memory limit |
| `--gc-threshold <n>` | Set garbage collection threshold |

See [CLI.md](CLI.md) for complete documentation.

## üìö Programming Guide

### Variables
```typescript
let x = 42;
let name = "TypeScript VM";
let isActive = true;
```

### Functions
```typescript
function add(a, b) {
  return a + b;
}

function factorial(n) {
  if (n <= 1) {
    return 1;
  }
  return n * factorial(n - 1);
}
```

### Control Flow
```typescript
// If-else
if (x > 0) {
  print("positive");
} else {
  print("not positive");
}

// While loop
let i = 0;
while (i < 5) {
  print(i);
  i = i + 1;
}

// For loop
for (let j = 0; j < 3; j++) {
  print("iteration: " + toString(j));
}
```

### Built-in Functions

#### I/O Functions
- `print(value)` - Output a value

#### Math Functions
- `abs(x)` - Absolute value
- `sqrt(x)` - Square root
- `pow(x, y)` - Power (x^y)

#### String Functions
- `length(str)` - String length
- `substring(str, start, end)` - Extract substring
- `concat(str1, str2)` - Concatenate strings

#### Type Conversion
- `toString(value)` - Convert to string
- `toNumber(value)` - Convert to number
- `toBoolean(value)` - Convert to boolean

## üß™ Development

### Running Tests

```bash
# Run all tests
npm test

# Run specific test suites
npm run test:integration
npm run test:cli
npm run test:performance

# Run with coverage
npm run test:coverage
```

### Building

```bash
# Build TypeScript to JavaScript
npm run build

# Development mode with watch
npm run dev
```

### Benchmarking

```bash
# Run performance benchmarks
npm run benchmark

# Run individual benchmark suites
npm run benchmark:memory
npm run benchmark:cpu
npm run benchmark:advanced
```

## üîç Debugging

### Interactive Debugger

```bash
tsvm --debug program.ts
```

Debugger commands:
- `step` - Execute next instruction
- `continue` - Continue execution
- `break <address>` - Set breakpoint
- `info stack` - Show stack contents
- `info vars` - Show variables
- `info memory` - Memory statistics
- `quit` - Exit debugger

### REPL Environment

```bash
tsvm --repl
```

REPL commands:
- `.help` - Show help
- `.exit` - Exit REPL
- `.clear` - Clear context
- `.save <file>` - Save session
- `.load <file>` - Load session

## üìä Performance

The TypeScript VM includes comprehensive performance monitoring:

### Benchmarking
```bash
tsvm --benchmark
```

Generates detailed reports including:
- Execution speed (operations per second)
- Memory usage and efficiency
- CPU utilization and hotspots
- Optimization effectiveness

### Memory Management
- Automatic garbage collection
- Memory leak detection
- Configurable memory limits
- Real-time memory statistics

### Optimization
- Compile-time optimizations (constant folding, dead code elimination)
- Multi-pass optimization with configurable limits
- Performance-aware code generation

## üèóÔ∏è Architecture Details

### Virtual Machine
- **Stack-based architecture** for efficient execution
- **Call stack management** for function calls and recursion
- **Variable scoping** with proper lexical scope handling
- **Error handling** with detailed stack traces

### Bytecode Format
The VM uses a simple, efficient bytecode format:

```
PUSH 42        // Push value onto stack
STORE x        // Store top of stack in variable x
LOAD x         // Load variable x onto stack
ADD            // Add top two stack values
CALL print     // Call built-in function
HALT           // Stop execution
```

### Memory Model
- **Heap management** with automatic garbage collection
- **Reference counting** for immediate cleanup
- **Mark-and-sweep** for cycle detection
- **Memory compaction** for fragmentation reduction

## ü§ù Contributing

We welcome contributions! Please see our contributing guidelines:

1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Ensure all tests pass
5. Submit a pull request

### Development Setup

```bash
git clone <repository-url>
cd typescript-vm
npm install
npm run build
npm test
```

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

- Inspired by modern JavaScript engines and virtual machines
- Built with TypeScript for type safety and developer experience
- Comprehensive testing with Jest framework
- Performance monitoring with custom profiling tools

## üìû Support

- **Documentation**: See [CLI.md](CLI.md) and [PROJECT_SUMMARY.md](PROJECT_SUMMARY.md)
- **Examples**: Check the `examples/` directory
- **Issues**: Report bugs and feature requests via GitHub issues
- **Discussions**: Join community discussions for questions and ideas

---

**TypeScript VM** - A complete virtual machine for TypeScript-like code execution with professional tooling and advanced optimizations.